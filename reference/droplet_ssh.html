<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Remotely execute ssh code, upload &amp; download files. — droplet_ssh • analogsea</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Remotely execute ssh code, upload &amp; download files. — droplet_ssh" />
<meta property="og:description" content="Assumes that you have ssh &amp;amp; scp installed, and password-less login set up on
the droplet." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">analogsea</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/analogsea.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/sckott/analogsea/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Remotely execute ssh code, upload &amp; download files.</h1>
    <small class="dont-index">Source: <a href='https://github.com/sckott/analogsea/blob/master/R/droplet-ssh.R'><code>R/droplet-ssh.R</code></a></small>
    <div class="hidden name"><code>droplet_ssh.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Assumes that you have ssh &amp; scp installed, and password-less login set up on
the droplet.</p>
    </div>

    <pre class="usage"><span class='fu'>droplet_ssh</span><span class='op'>(</span>
  <span class='va'>droplet</span>,
  <span class='va'>...</span>,
  user <span class='op'>=</span> <span class='st'>"root"</span>,
  keyfile <span class='op'>=</span> <span class='cn'>NULL</span>,
  ssh_passwd <span class='op'>=</span> <span class='cn'>NULL</span>,
  verbose <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span>

<span class='fu'>droplet_upload</span><span class='op'>(</span>
  <span class='va'>droplet</span>,
  <span class='va'>local</span>,
  <span class='va'>remote</span>,
  user <span class='op'>=</span> <span class='st'>"root"</span>,
  keyfile <span class='op'>=</span> <span class='cn'>NULL</span>,
  ssh_passwd <span class='op'>=</span> <span class='cn'>NULL</span>,
  verbose <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span>

<span class='fu'>droplet_download</span><span class='op'>(</span>
  <span class='va'>droplet</span>,
  <span class='va'>remote</span>,
  <span class='va'>local</span>,
  user <span class='op'>=</span> <span class='st'>"root"</span>,
  keyfile <span class='op'>=</span> <span class='cn'>NULL</span>,
  ssh_passwd <span class='op'>=</span> <span class='cn'>NULL</span>,
  verbose <span class='op'>=</span> <span class='cn'>FALSE</span>,
  overwrite <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>droplet</th>
      <td><p>A droplet, or something that can be coerced to a droplet by
<code><a href='droplet.html'>as.droplet</a></code>.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Shell commands to run. Multiple commands are combined with
<code>&amp;&amp;</code> so that execution will halt after the first failure.</p></td>
    </tr>
    <tr>
      <th>user</th>
      <td><p>User name. Defaults to "root".</p></td>
    </tr>
    <tr>
      <th>keyfile</th>
      <td><p>Optional private key file.</p></td>
    </tr>
    <tr>
      <th>ssh_passwd</th>
      <td><p>Optional passphrase or callback function for authentication.
Refer to the <code><a href='https://docs.ropensci.org/ssh/reference/ssh.html'>ssh::ssh_connect</a></code> documentation for more
details.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>If TRUE, will print command before executing it.</p></td>
    </tr>
    <tr>
      <th>local, remote</th>
      <td><p>Local and remote paths.</p></td>
    </tr>
    <tr>
      <th>overwrite</th>
      <td><p>If TRUE, then overwrite destination files if they already
exist.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>On success, the droplet (invisibly). On failure, throws an error.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Uploads and downloads are recursive, so if you specify a directory,
everything inside the directory will also be downloaded.</p>
<p>With the chang to package <code>ssh</code>, we create ssh session objects
(C pointers) internally, and cache them, then look them up in the cache
based on combination of user and IP address. That is, there's separate
sessions for each user for the same IP address.</p>
<p>ssh sessions are cleaned up at the end of your R session.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='va'>d</span> <span class='op'>&lt;-</span> <span class='fu'><a href='droplet_create.html'>droplet_create</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='droplet_wait.html'>droplet_wait</a></span><span class='op'>(</span><span class='op'>)</span>

<span class='co'># Upgrade system packages</span>
<span class='va'>d</span> <span class='op'>%&gt;%</span>
  <span class='fu'>droplet_ssh</span><span class='op'>(</span><span class='st'>"apt-get update"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>droplet_ssh</span><span class='op'>(</span><span class='st'>"sudo apt-get upgrade -y --force-yes"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>droplet_ssh</span><span class='op'>(</span><span class='st'>"apt-get autoremove -y"</span><span class='op'>)</span>

<span class='co'># Install R</span>
<span class='va'>d</span> <span class='op'>%&gt;%</span>
  <span class='fu'>droplet_ssh</span><span class='op'>(</span><span class='st'>"apt-get install r-base-core r-base-dev --yes --force-yes"</span><span class='op'>)</span>

<span class='co'># Upload and download files -------------------------------------------------</span>

<span class='va'>tmp</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempfile</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span><span class='va'>mtcars</span>, <span class='va'>tmp</span><span class='op'>)</span>
<span class='va'>d</span> <span class='op'>%&gt;%</span> <span class='fu'>droplet_upload</span><span class='op'>(</span><span class='va'>tmp</span>, <span class='st'>"."</span><span class='op'>)</span>
<span class='va'>d</span> <span class='op'>%&gt;%</span> <span class='fu'>droplet_ssh</span><span class='op'>(</span><span class='st'>"ls"</span><span class='op'>)</span>

<span class='va'>tmp2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>d</span> <span class='op'>%&gt;%</span> <span class='fu'>droplet_download</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/basename.html'>basename</a></span><span class='op'>(</span><span class='va'>tmp</span><span class='op'>)</span>, <span class='va'>tmp2</span><span class='op'>)</span>
<span class='va'>mtcars2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>readRDS</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>tmp2</span>, <span class='fu'><a href='https://rdrr.io/r/base/basename.html'>basename</a></span><span class='op'>(</span><span class='va'>tmp</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/stopifnot.html'>stopifnot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/all.equal.html'>all.equal</a></span><span class='op'>(</span><span class='va'>mtcars</span>, <span class='va'>mtcars2</span><span class='op'>)</span><span class='op'>)</span>


<span class='co'>## another upload/download example</span>
<span class='va'>tmp</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempfile</a></span><span class='op'>(</span>fileext <span class='op'>=</span> <span class='st'>".txt"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/writeLines.html'>writeLines</a></span><span class='op'>(</span><span class='st'>"foo bar"</span>, <span class='va'>tmp</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/readLines.html'>readLines</a></span><span class='op'>(</span><span class='va'>tmp</span><span class='op'>)</span>
<span class='va'>d</span> <span class='op'>%&gt;%</span> <span class='fu'>droplet_upload</span><span class='op'>(</span><span class='va'>tmp</span>, <span class='st'>"."</span><span class='op'>)</span>
<span class='va'>d</span> <span class='op'>%&gt;%</span> <span class='fu'>droplet_ssh</span><span class='op'>(</span><span class='st'>"ls"</span><span class='op'>)</span>

<span class='va'>tmp2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/unlink.html'>unlink</a></span><span class='op'>(</span><span class='va'>tmp</span><span class='op'>)</span>
<span class='va'>d</span> <span class='op'>%&gt;%</span> <span class='fu'>droplet_download</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/basename.html'>basename</a></span><span class='op'>(</span><span class='va'>tmp</span><span class='op'>)</span>, <span class='va'>tmp2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/readLines.html'>readLines</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>tmp2</span>, <span class='fu'><a href='https://rdrr.io/r/base/basename.html'>basename</a></span><span class='op'>(</span><span class='va'>tmp</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Scott Chamberlain, <a href='http://hadley.nz'>Hadley Wickham</a>, Winston Chang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


